<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook V4.1//EN">

<article>
<articleinfo>
<!-- $MVD$:app("MicroVision WebExpress","769") -->
<!-- $MVD$:template("","0","0") -->
<!-- $MVD$:color("18","840084","Custom #1","0") -->
<!-- $MVD$:color("19","e0e0e0","Custom #2","0") -->
<!-- $MVD$:color("20","80ff","Orange","1") -->
<!-- $MVD$:color("21","ffd6ce","Lavender","1") -->
<!-- $MVD$:fontset("Courier","Courier New") -->
<title>Restore-Related Tips</title>
</articleinfo>

<para></para>
<informaltable><tgroup cols="3"><tbody>
<row>
<entry>
Mondo Rescue and Mindi Linux HOWTO
</entry>
</row>
<row>
<entry>
<ulink url="restoreoverview.html">Prev</ulink>
</entry>
<entry>
Chapter 9. Restore
</entry>
<entry>
<ulink url="faq.html">Next</ulink>
</entry>
</row>
</tbody></tgroup></informaltable>

<sect1 id="RESTORETIP"><title>9.2. Restore-Related Tips</title>
<para>Ideally, restore your system to a spare hard drive to test
the integrity and reliability of your disks. To do that, either
edit your mountlist to make the devices point to your spare hard
drive, or swap your hard drive cables between boots.</para>
<para>At a bare minimum, compare your CD against your file system
before you decide whether to trust them.</para>
<para>To test Mondo's ability to handle your LILO or GRUB boot
loader and accompanying configuration file:</para>
<itemizedlist>
<listitem>
<para>Boot from the backup CD into Expert Mode</para>
</listitem>
<listitem>
<para>Type:</para>
</listitem>
</itemizedlist>
<para></para>
<informaltable><tgroup cols="1"><tbody>
<row>
<entry>

bash# mondorestore --mbr

</entry>
</row>
</tbody></tgroup></informaltable>

<itemizedlist>
<listitem>
<para>To fix any mess it made (not that it should) type:</para>
</listitem>
</itemizedlist>
<para></para>
<informaltable><tgroup cols="1"><tbody>
<row>
<entry>

bash# mount-mebash# chroot /mnt/RESTORINGbash# lilo OR grub-install '(hd0)'bash# exitbash# unmount-me

</entry>
</row>
</tbody></tgroup></informaltable>

<itemizedlist>
<listitem>
<para>If it did not work then please copy /tmp/mondo-restore.log to
a floppy (or to your hard disk), gzip it and e-mail it to the
mailing list.</para>
</listitem>
</itemizedlist>
<sect2 id="AEN39"><title>9.2.1. Barebones (Nuke) Restore</title>
<para>Imagine that your hard drives happen to be wiped,
deliberately or accidentally. Or, imagine that you want to clone
your existing operating system. In either case, you want to run in
Nuke Mode.</para>
<para>If you want to wipe everything and restore your whole system
from CD, please:</para>
<itemizedlist>
<listitem>
<para>Boot from the first Mondo CD</para>
</listitem>
<listitem>
<para>Press &lt;enter&gt;</para>
</listitem>
<listitem>
<para>Insert the subsequent CD when asked</para>
</listitem>
<listitem>
<para>Watch the screen for errors</para>
</listitem>
</itemizedlist>
<para>That's it. The restoration process for tape or NFS users is
similarly easy: just boot, answer the on-screen prompts, and
wait.</para>
<para>Now, should something go wrong, you will be able to examine
/tmp/mondo-restore.log to see what happened. All is not lost. You
can fdisk and format the partitions yourself, using the tools that
come with the CD. You can then run mondorestore in Interactive Mode
and say 'no' when asked if you want Mondo to partition/format your
drives.</para>
<para>If you want to see exactly what Mondo is doing while it is
restoring, press &lt;Alt&gt;&lt;left cursor&gt; to view its
logfile, in a virtual console, scrolling past.</para>
</sect2><sect2 id="AEN40"><title>9.2.2. Interactive Restore</title>
<para>Interactive Mode is for people who have lost a subset of data
from their live file system, or perhaps who have lost some data
from their latest backup and want to restore a subset of data from
an earlier backup. If you want to restore only some files or if you
do not want to prep/format your drives, then you should boot into
Interactive Mode. The interactive mode will provide an 'Editing
mountlist screen' that allows you to setup a different disk
geometry.</para>
<para>To move up and down between partitions in the 'Editing
mountlist screen', use the Up and Down arrows. To move between the
main window and the buttons at the bottom, use the Left and Right
cursor keys. TAB shifts focus from one screen item to the other in
a haphazard fashion, owing to the complexities of the Newt
library.</para>
<para>If you want to restore selectively, just press &lt;enter&gt;
and follow the on-screen instructions. You will be asked to say
yes/no to a range of questions.</para>
<para>If you are planning to modify your partition table, you would
do well to read up on the partition layout and the use of fdisk, it
gives you some could pointers on how to best lay out partitions.
You can find good guide her.
<ulink url="http://www.ibiblio.org/pub/Linux/docs/HOWTO/mini/Partition/index.html">http://www.ibiblio.org/pub/Linux/docs/HOWTO/mini/Partition/index.html</ulink></para>
<para>If you want to restore a subset of the backup then:</para>
<itemizedlist>
<listitem>
<para>Boot from the CD</para>
</listitem>
<listitem>
<para>Type:</para>
</listitem>
</itemizedlist>
<para></para>
<informaltable><tgroup cols="1"><tbody>
<row>
<entry>

bash# interactive 

</entry>
</row>
</tbody></tgroup></informaltable>

<itemizedlist>
<listitem>
<para>Then, after booting, answer the questions as follows:</para>
</listitem>
</itemizedlist>
<para></para>
<informaltable><tgroup cols="1"><tbody>
<row>
<entry>

Do you want to partition your devices? noDo you want to format them? noDo you want to restore everything? noDo you want to restore something? yesWhich path do you want to restore? /home/hugo [e.g.]Do you want to run LILO to setup your boot sectors? Yes 

</entry>
</row>
</tbody></tgroup></informaltable>

</sect2><sect2 id="AEN42"><title>9.2.3. Expert Restore</title>
<para>If you are planning to modify your partition table, you would
do well to read up on the partition layout and the use of fdisk, it
gives you some could pointers on how to best lay out partitions.
You can find good guide her.
<ulink url="http://www.ibiblio.org/pub/Linux/docs/HOWTO/mini/Partition/index.html">http://www.ibiblio.org/pub/Linux/docs/HOWTO/mini/Partition/index.html</ulink></para>
<para>To restore manually, please:</para>
<itemizedlist>
<listitem>
<para>Boot from the first CD, then type:</para>
</listitem>
</itemizedlist>
<para></para>
<informaltable><tgroup cols="1"><tbody>
<row>
<entry>

bash# expert 

</entry>
</row>
</tbody></tgroup></informaltable>

<itemizedlist>
<listitem>
<para>Then do whatever you like. :) You may type the following, of
course:</para>
</listitem>
</itemizedlist>
<para></para>
<informaltable><tgroup cols="1"><tbody>
<row>
<entry>

bash# mondorestore

</entry>
</row>
</tbody></tgroup></informaltable>

</sect2><sect2 id="AEN44"><title>9.2.4. Modified partitions -
Restore to a different disk geometry</title>
<para>One of the nice things about Mondo is that it lets you wipe
your existing system and restore it in any layout you like (within
reason). You can move from non-RAID to RAID,install and utilize
additional drives, move from ext2 to ReiserFS, etc., all without
risking the loss of data.</para>
<para>If the user excluded a particular partition from backup and
specifically excluded it from the mountlist itself using -E then
Mondo will insert a small (32MB) partition at restore-time, in
order to avoid having to re-jig fstab, the partition table,
etc.</para>
<para>To do this:</para>
<itemizedlist>
<listitem>
<para>Boot into Expert Mode, then type:</para>
</listitem>
</itemizedlist>
<para></para>
<informaltable><tgroup cols="1"><tbody>
<row>
<entry>

bash# mondorestore

</entry>
</row>
</tbody></tgroup></informaltable>

<itemizedlist>
<listitem>
<para>(edit the mountlist using the on-screen editor)</para>
</listitem>
</itemizedlist>
<para>If you want to move from ext2 to ReiserFS, you can do it here
(so long as your kernel supports ReiserFS). Ditto for XFS, JFS or
ext3.</para>
<para>Mondorestore will try to modify your /etc/fstab to reflect
changes you have made to the mountlist. If you are not using LILO,
you can still create your own /mnt/RESTORING/etc/lilo.conf and run
lilo -r /mnt/RESTORING to configure your boot sectors and Master
Boot Record.</para>
<para>Mondo (technically, Mindi on behalf of Mondo) creates a file
called a mountlist. This can be found on the ramdisk at
/tmp/mountlist.txt; it looks something like this:</para>
<para></para>
<informaltable><tgroup cols="1"><tbody>
<row>
<entry>

/dev/hda1/mnt/windows vfat 4096000/dev/hda5 / reiserfs 6023000&gt;/dev/hda6 /tmp xfs 955000/dev/hda7 /usr xfs 4096000 

</entry>
</row>
</tbody></tgroup></informaltable>

<para>It is fairly easy to understand the list. Each line refers to
a single device/partition. The line format is:</para>
<para></para>
<informaltable><tgroup cols="1"><tbody>
<row>
<entry>

&lt;device&gt; &lt;partition&gt; &lt;format&gt; &lt;Kilobytes&gt; 

</entry>
</row>
</tbody></tgroup></informaltable>

<para>If you have added a hard drive and want to take advantage of
the additional space, you could amend the above mountlist to
read:</para>
<para></para>
<informaltable><tgroup cols="1"><tbody>
<row>
<entry>

/dev/hda1/mnt/windows vfat 6096000/dev/hda5 / reiserfs 9123000/dev/hda6 /tmp xfs 955000/dev/hdb1 /usr xfs 8192000/dev/hdb2 /home xfs 8192000 

</entry>
</row>
</tbody></tgroup></informaltable>

<para>This assumes that your old hard drive is /dev/hda and the new
hard drive is /dev/hdb.</para>
<para>Or, if you want to add RAID support, create a new
/etc/raidtab on the ramdisk (which is beyond the scope of this
HOWTO) and then write a mountlist like this:</para>
<para></para>
<informaltable><tgroup cols="1"><tbody>
<row>
<entry>

/dev/hda1 /mnt/windows vfat 6096000/dev/md0 / reiserfs 9123000/dev/md1 /tmp xfs 955000/dev/md2 xfs 8192000/dev/md3 /home xfs 8192000 

</entry>
</row>
</tbody></tgroup></informaltable>

<para>So long as your /etc/raidtab file is sane, Mondo can
automatically partition and format your disks for you, including
the RAID devices.</para>
<para>Once you have finished editing /tmp/mountlist.txt using
mondorestore's built-in editor then you may choose 'OK'. Please
note that this will not write anything to your hard disk. You will
only reformat or repartition your disks if you say 'Yes' when asked
if you want to do those things.</para>
</sect2><sect2 id="AEN47"><title>9.2.5. Advanced</title>
<para>It is now possible to restore to a live filesystem using
Mondo. In other words, you do not have to boot your PC from your
CD/floppy in order to restore files. Mondo was originally designed
for disaster recovery - situations in which you cannot boot your
PC. If you can boot your PC, it is not really a disaster, is it? :)
Well, if you have wiped out your priceless collection of "MTV's
Bjork Unplugged" MP3's, perhaps it is. Anyway, just type this as
root</para>
<para></para>
<informaltable><tgroup cols="1"><tbody>
<row>
<entry>

bash# mondorestore

</entry>
</row>
</tbody></tgroup></informaltable>

<para></para>
<informaltable><tgroup cols="2"><tbody>
<row>
<entry>
<ulink url="images/rest1.png"><inlinemediaobject><imageobject>
<imagedata fileref="images/rest1-mini.png">
</imageobject></inlinemediaobject>
</ulink>
</entry>
<entry>
Choose your type of backup media. The live restoration process is
very similar to what you'll experience if you type mondorestore
with no parameters after booting from a Mondo CD/floppy.
</entry>
</row>
<row>
<entry>
<ulink url="images/rest2.png"><inlinemediaobject><imageobject>
<imagedata fileref="images/rest2-mini.png">
</imageobject></inlinemediaobject>
</ulink>
</entry>
<entry>
Hit 'OK' when you have inserted the tape/CD. If you generated a
tape backup, the tape itself should be enough. If you generated a
CD backup, the first CD should be enough. Otherwise, you may need
the boot floppy.
</entry>
</row>
<row>
<entry>
<ulink url="images/rest3.png"><inlinemediaobject><imageobject>
<imagedata fileref="images/rest3-mini.png">
</imageobject></inlinemediaobject>
</ulink>
</entry>
<entry>
Flag the files and directories you wish to restore. Use the 'More'
and 'Less' buttons to open and close subdirectories.
</entry>
</row>
<row>
<entry>
<ulink url="images/rest4.png"><inlinemediaobject><imageobject>
<imagedata fileref="images/rest4-mini.png">
</imageobject></inlinemediaobject>
</ulink>
</entry>
<entry>
Specify the location to restore the files to. In general, '/' is
appropriate. If you do not want to overwrite newer versions of the
files you are restoring then specify /tmp/BKP or similar as the
restore path.
</entry>
</row>
<row>
<entry>
<ulink url="images/rest5.png"><inlinemediaobject><imageobject>
<imagedata fileref="images/rest5-mini.png">
</imageobject></inlinemediaobject>
</ulink>
</entry>
<entry>
Mondorestore will retrieve configuration information from the
media. (The sample screen is for tape users. CD users will see
something different.)
</entry>
</row>
<row>
<entry>
<ulink url="images/rest6.png"><inlinemediaobject><imageobject>
<imagedata fileref="images/rest6-mini.png">
</imageobject></inlinemediaobject>
</ulink>
</entry>
<entry>
Data will be restored to the hard disk - first the regular files,
then any big (32MB or greater) files in the restore set.
</entry>
</row>
</tbody></tgroup></informaltable>

<para>I hope this manual is proving to be useful to you.</para>
<para></para>
<informaltable><tgroup cols="3"><tbody>
<row>
<entry>
<ulink url="restoreoverview.html">Prev</ulink>
</entry>
<entry>
<ulink url="index.html">Home</ulink>
</entry>
<entry>
<ulink url="faq.html">Next</ulink>
</entry>
</row>
<row>
<entry>
Overview
</entry>
<entry>
<ulink url="restore.html">Up</ulink>
</entry>
<entry>
Troubleshooting/FAQ
</entry>
</row>
</tbody></tgroup></informaltable>


</sect2></sect1></article>
